# 조언 카드 기능 추가 완료 ✨

## 🎴 새로운 기능: 조언 카드

타로 리딩 후 **추가로 한 장의 조언 카드**를 뽑아 실천 가능한 구체적인 메시지를 받을 수 있습니다!

## 🌟 특징

### 1. 기본 활성화
- 타로 리딩 화면에서 조언 카드 옵션이 **기본적으로 체크**되어 있습니다
- 원하지 않으면 체크박스를 해제할 수 있습니다

### 2. AI 기반 해석
- 조언 카드도 AI가 종합적으로 해석합니다
- 사주, 메인 타로 카드와의 연관성을 고려한 맞춤형 조언
- 실천 가능한 구체적인 방법 제시

### 3. 시각적 강조
- 조언 카드는 금색 테두리로 특별히 표시됩니다
- 별도 섹션으로 구분되어 쉽게 확인 가능
- AI 해석이 있으면 추가 섹션으로 표시

## 📱 사용 방법

### 1. 타로 리딩 화면
```
✅ 조언 카드 추가
   해석 후 추가로 한 장의 조언 카드를 뽑아 실천 방안을 제시합니다

[카드 뽑기 + 조언 카드]
```

### 2. 결과 화면

#### 메인 타로 카드들
- 선택한 스프레드에 따른 카드 (1~10장)

#### ✨ 조언 카드 (금색 강조)
- 별도로 크게 표시
- 카드의 기본 의미
- 키워드 태그

#### AI 조언 카드 해석
- AI가 생성한 심화 해석
- 구체적인 실천 방법
- 150자 이상의 상세한 설명

## 🔧 구현 상세

### Backend 변경사항

#### 1. TarotService (`tarot.service.ts`)
```typescript
drawCards(spreadType, question, includeAdviceCard = false): DrawnCard[]
```
- `includeAdviceCard` 파라미터 추가
- true일 경우 마지막에 조언 카드 한 장 추가
- 포지션: "조언 카드"

#### 2. AI Service (`ai.service.ts`)
```typescript
generateAdvancedInterpretation(): Promise<{
  interpretation: string;
  elementalHarmony: string;
  personalizedAdvice: string;
  adviceCardInterpretation?: string;  // 새로 추가
}>
```
- 조언 카드가 있으면 별도 섹션으로 해석
- AI 프롬프트에 조언 카드 정보 포함
- 4번째 섹션으로 "조언 카드 해석" 추가

#### 3. AI Interpretation Controller
```typescript
POST /api/ai/ai-reading
Body: {
  question: string;
  spreadType: SpreadType;
  includeAdviceCard?: boolean;  // 새로 추가
}
```

### Frontend 변경사항

#### 1. TarotReading 컴포넌트
- 조언 카드 체크박스 추가
- 기본값: `true` (활성화)
- 버튼 텍스트: "카드 뽑기 + 조언 카드"

#### 2. IntegratedResult 컴포넌트
- 조언 카드와 메인 카드 자동 분리
- 조언 카드 별도 표시 (금색 테마)
- AI 조언 카드 해석 섹션 추가

#### 3. API 서비스
```typescript
aiApi.getAIReading(question, spreadType, includeAdviceCard)
```

#### 4. 타입 정의
```typescript
interface IntegratedReading {
  // ... 기존 필드들
  adviceCardInterpretation?: string;  // 새로 추가
}
```

## 🎯 AI 프롬프트 구조

```
[뽑힌 타로 카드 (스프레드 타입)]
1. 포지션1: 카드명...
2. 포지션2: 카드명...
...

[추가 조언 카드]
카드명 - 정방향/역방향
의미: ...
오행: ...

다음 네 부분으로 나누어 답변:
1. **통합 해석**: ...
2. **오행 조화 분석**: ...
3. **맞춤형 조언**: ...
4. **조언 카드 해석**: 조언 카드가 전하는 메시지와 실천 방법 (150자 이상)
```

## 💡 조언 카드 활용 예시

### 예시 1: 재물운 질문
- **질문**: "올해 나의 재물운은 어떨까요?"
- **메인 카드**: 사주 맞춤형 스프레드 (5장)
- **조언 카드**: 펜타클 에이스 (정방향)
- **AI 해석**: "새로운 재정적 기회가 다가오고 있습니다. 구체적으로..."

### 예시 2: 직업 전환
- **질문**: "이직이 성공할까요?"
- **메인 카드**: 쓰리 카드 스프레드
- **조언 카드**: 힘 (정방향)
- **AI 해석**: "내면의 용기와 인내심이 필요한 시기입니다. 실천 방법으로..."

### 예시 3: 인간관계
- **질문**: "이 관계를 계속 유지해야 할까요?"
- **메인 카드**: 켈트 십자가
- **조언 카드**: 절제 (역방향)
- **AI 해석**: "균형을 잃기 쉬운 상황입니다. 주의해야 할 점은..."

## 🔍 조언 카드 vs 메인 카드

| 구분 | 메인 카드 | 조언 카드 |
|------|-----------|-----------|
| **개수** | 1~10장 (스프레드에 따라) | 항상 1장 |
| **목적** | 상황 분석, 과거/현재/미래 | 구체적 행동 지침 |
| **포지션** | 스프레드별 정해진 의미 | "조언 카드" 고정 |
| **표시** | 일반 카드 스타일 | 금색 강조 스타일 |
| **해석** | 통합 해석에 포함 | 별도 섹션 |
| **선택** | 필수 | 선택 사항 (기본 활성화) |

## 🎨 UI/UX 특징

### 타로 리딩 화면
```
┌─────────────────────────────────┐
│ ✅ 조언 카드 추가                │
│    해석 후 추가로 한 장의 조언   │
│    카드를 뽑아 실천 방안을       │
│    제시합니다                     │
└─────────────────────────────────┘

[카드 뽑기 + 조언 카드]
```

### 결과 화면 - 조언 카드 섹션
```
╔═══════════════════════════════════╗
║ ✨ 조언 카드                      ║
╠═══════════════════════════════════╣
║   🎴                              ║
║ 카드명 (Card Name)                ║
║                                   ║
║ [의미 설명]                       ║
║ 키워드1  키워드2  키워드3          ║
╚═══════════════════════════════════╝
```

### AI 조언 카드 해석 섹션
```
╔═══════════════════════════════════╗
║ ✨ 조언 카드 AI 해석              ║
╠═══════════════════════════════════╣
║                                   ║
║ AI가 생성한 상세한 해석...         ║
║ 실천 가능한 구체적 방법...         ║
║                                   ║
╚═══════════════════════════════════╝
```

## 📊 통계 및 효과

### 예상 효과
- **사용자 만족도 향상**: 구체적인 행동 지침 제공
- **리딩 완성도**: 분석 + 조언으로 2단계 해석
- **재방문율 증가**: 실천 후 결과 확인 욕구

### 데이터 포인트
- MongoDB에 `includeAdviceCard` 여부 저장
- 조언 카드 사용 비율 추적 가능
- 사용자 피드백 수집 가능

## 🚀 향후 개선 계획

### Phase 1 (현재)
- [x] 조언 카드 기본 기능
- [x] AI 해석 통합
- [x] UI/UX 구현

### Phase 2 (향후)
- [ ] 조언 카드 전용 덱 (긍정적 카드 위주)
- [ ] 조언 카드 히스토리 분석
- [ ] 실천 체크리스트 기능

### Phase 3 (고급)
- [ ] 조언 카드 추천 시스템
- [ ] 과거 조언 카드 효과 분석
- [ ] 사용자별 조언 패턴 학습

## 🔒 주의사항

### 개발자
- 조언 카드는 항상 배열의 마지막에 추가됨
- `positionMeaning === '조언 카드'`로 식별
- AI 해석 파싱 시 4번째 섹션 확인

### 사용자
- 조언 카드는 선택사항입니다
- 메인 카드와 별개로 해석됩니다
- AI API 키가 있어야 상세 해석이 가능합니다

## ✅ 테스트 체크리스트

### Backend
- [x] `includeAdviceCard=true` 시 카드 추가
- [x] `includeAdviceCard=false` 시 기본 동작
- [x] AI 프롬프트에 조언 카드 포함
- [x] 4번째 섹션 파싱

### Frontend
- [x] 체크박스 기본 활성화
- [x] 조언 카드 별도 표시
- [x] AI 해석 별도 섹션
- [x] 모바일 반응형

## 📝 사용 예시 코드

### API 호출
```javascript
const reading = await aiApi.getAIReading(
  "올해 나의 재물운은?", 
  "saju-custom",
  true  // 조언 카드 포함
);

console.log(reading.drawnCards.length); // 6장 (5 + 1)
console.log(reading.adviceCardInterpretation); // AI 조언 카드 해석
```

### 조언 카드 필터링
```javascript
const adviceCard = reading.drawnCards.find(
  card => card.positionMeaning === '조언 카드'
);

if (adviceCard) {
  console.log(`조언: ${adviceCard.card.nameKo}`);
}
```

## 🎁 보너스: 조언 카드 키워드 매핑

| 오행 | 추천 조언 카드 타입 |
|------|---------------------|
| 목(木) 부족 | Wands (창의성, 성장) |
| 화(火) 부족 | Cups (열정, 관계) |
| 토(土) 부족 | Pentacles (안정, 실용) |
| 금(金) 부족 | Swords (논리, 결단) |
| 수(水) 부족 | Major Arcana (지혜) |

---

**조언 카드 기능으로 더욱 실용적인 타로 리딩을!** ✨🎴

**업데이트 일자**: 2025-10-28  
**버전**: 1.1.0 (AI 기능 + 조언 카드)
