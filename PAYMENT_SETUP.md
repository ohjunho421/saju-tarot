# λ λ¬μ¤ν€΄μ§€ κ²°μ  μ‹μ¤ν… μ„¤μ • κ°€μ΄λ“

## π“‹ κ°μ”

μ΄ λ¬Έμ„λ” μ‚¬μ£Ό λ§μ„Έλ ¥ νƒ€λ΅ μ„λΉ„μ¤μ— λ λ¬μ¤ν€΄μ§€(Lemon Squeezy) κ²°μ  μ‹μ¤ν…μ„ μ„¤μ •ν•λ” λ°©λ²•μ„ μ•λ‚΄ν•©λ‹λ‹¤.

## π’° ν¬μΈνΈ μ‹μ¤ν…

### μ¤ν”„λ λ“λ³„ ν•„μ” ν¬μΈνΈ

| μ¤ν”„λ λ“ | μΉ΄λ“ μ | ν•„μ” ν¬μΈνΈ | κ°€κ²© |
|---------|--------|------------|------|
| μ›μΉ΄λ“ | 1μ¥ | 1,000P | β‚©1,000 |
| ν¬μΉ΄λ“ | 2μ¥ | 2,000P | β‚©2,000 |
| μ“°λ¦¬μΉ΄λ“ | 3μ¥ | 3,000P | β‚©3,000 |
| νμ΄λΈμΉ΄λ“ | 5μ¥ | 5,000P | β‚©5,000 |
| μ‚¬μ£Ό μ»¤μ¤ν…€ | 5μ¥ | 5,000P | β‚©5,000 |
| μΌν‹±ν¬λ΅μ¤ | 10μ¥ | 10,000P | β‚©10,000 |

### ν¬μΈνΈ μ¶©μ „ ν¨ν‚¤μ§€

| ν¨ν‚¤μ§€ | ν¬μΈνΈ | κ°€κ²© | λ³΄λ„μ¤ |
|-------|-------|------|-------|
| κΈ°λ³Έ | 5,000P | β‚©5,000 | - |
| μ¤νƒ λ‹¤λ“ | 10,000P | β‚©10,000 | - |
| ν”„λ¦¬λ―Έμ—„ | 30,000P | β‚©27,000 | +3,000P (10%) |
| VIP | 50,000P | β‚©42,500 | +7,500P (15%) |

## π”§ μ„¤μ • λ°©λ²•

### 1. λ λ¬μ¤ν€΄μ§€ κ³„μ • μ„¤μ •

1. [Lemon Squeezy](https://lemonsqueezy.com)μ—μ„ κ³„μ • μƒμ„±
2. μ¤ν† μ–΄ μƒμ„± λ° μ„¤μ •
3. ν¬μΈνΈ ν¨ν‚¤μ§€ μƒν’ μƒμ„± (4κ°)
4. κ° μƒν’μ Variant ID κΈ°λ΅

### 2. ν™κ²½ λ³€μ μ„¤μ •

`server/.env` νμΌμ— λ‹¤μ ν™κ²½ λ³€μλ¥Ό μ¶”κ°€ν•μ„Έμ”:

```env
# Lemon Squeezy κ²°μ  μ„¤μ •
LEMON_SQUEEZY_API_KEY=your_api_key_here
LEMON_SQUEEZY_STORE_ID=your_store_id_here
LEMON_SQUEEZY_WEBHOOK_SECRET=your_webhook_secret_here

# ν΄λΌμ΄μ–ΈνΈ URL (κ²°μ  μ™„λ£ ν›„ λ¦¬λ‹¤μ΄λ ‰νΈ)
CLIENT_URL=http://localhost:5173
```

### 3. Variant ID λ§¤ν•‘

`client/src/components/PointChargeModal.tsx` νμΌμ—μ„ Variant IDλ¥Ό μ—…λ°μ΄νΈν•μ„Έμ”:

```typescript
const VARIANT_IDS: Record<string, string> = {
  basic: 'YOUR_BASIC_VARIANT_ID',      // 5,000P ν¨ν‚¤μ§€
  standard: 'YOUR_STANDARD_VARIANT_ID', // 10,000P ν¨ν‚¤μ§€
  premium: 'YOUR_PREMIUM_VARIANT_ID',   // 30,000P ν¨ν‚¤μ§€
  vip: 'YOUR_VIP_VARIANT_ID',           // 50,000P ν¨ν‚¤μ§€
};
```

### 4. μ›Ήν›… μ„¤μ •

λ λ¬μ¤ν€΄μ§€ λ€μ‹λ³΄λ“μ—μ„ μ›Ήν›…μ„ μ„¤μ •ν•μ„Έμ”:

1. Settings β†’ Webhooks β†’ New Webhook
2. URL: `https://your-domain.com/api/payment/webhook`
3. Events: `order_created` μ„ νƒ
4. Signing Secret λ³µμ‚¬ν•μ—¬ ν™κ²½ λ³€μμ— μ„¤μ •

### 5. λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ…

```bash
cd server
npx prisma migrate dev --name add_points_system
npx prisma generate
```

## π“ νμΌ κµ¬μ΅°

### μ„λ²„ (Backend)

```
server/src/
β”β”€β”€ config/
β”‚   β””β”€β”€ payment.config.ts      # ν¬μΈνΈ/κ²°μ  μ„¤μ •
β”β”€β”€ controllers/
β”‚   β””β”€β”€ payment.controller.ts  # κ²°μ  API μ»¨νΈλ΅¤λ¬
β”β”€β”€ routes/
β”‚   β””β”€β”€ payment.routes.ts      # κ²°μ  λΌμ°νΈ
β”β”€β”€ services/
β”‚   β””β”€β”€ point.service.ts       # ν¬μΈνΈ μ„λΉ„μ¤
β””β”€β”€ prisma/
    β””β”€β”€ schema.prisma          # DB μ¤ν‚¤λ§ (User.points, PointTransaction)
```

### ν΄λΌμ΄μ–ΈνΈ (Frontend)

```
client/src/
β”β”€β”€ components/
β”‚   β”β”€β”€ PointBadge.tsx         # ν¬μΈνΈ ν‘μ‹ λ°°μ§€
β”‚   β”β”€β”€ PointChargeModal.tsx   # ν¬μΈνΈ μ¶©μ „ λ¨λ‹¬
β”‚   β””β”€β”€ ReadingPaywall.tsx     # ν•΄μ„ μ κΈ/ν•΄μ  μ»΄ν¬λ„νΈ
β”β”€β”€ store/
β”‚   β””β”€β”€ usePointStore.ts       # ν¬μΈνΈ μƒνƒ κ΄€λ¦¬
β”β”€β”€ services/
β”‚   β””β”€β”€ api.ts                 # paymentApi μ¶”κ°€
β””β”€β”€ types/
    β””β”€β”€ index.ts               # PointPackage, PointTransaction νƒ€μ…
```

## π” API μ—”λ“ν¬μΈνΈ

### κ³µκ° API

| Method | Endpoint | μ„¤λ… |
|--------|----------|------|
| GET | `/api/payment/packages` | ν¬μΈνΈ ν¨ν‚¤μ§€ λ©λ΅ |
| GET | `/api/payment/spread-cost/:spreadType` | μ¤ν”„λ λ“λ³„ ν•„μ” ν¬μΈνΈ |

### μΈμ¦ ν•„μ” API

| Method | Endpoint | μ„¤λ… |
|--------|----------|------|
| GET | `/api/payment/points` | λ‚΄ ν¬μΈνΈ μ”μ•΅ |
| GET | `/api/payment/history` | ν¬μΈνΈ κ±°λ λ‚΄μ—­ |
| GET | `/api/payment/check` | ν¬μΈνΈ μ¶©λ¶„ μ—¬λ¶€ ν™•μΈ |
| POST | `/api/payment/checkout` | μ²΄ν¬μ•„μ›ƒ μ„Έμ… μƒμ„± |
| POST | `/api/payment/use` | ν¬μΈνΈ μ‚¬μ© (ν•΄μ„ μ—΄λ) |

### μ›Ήν›…

| Method | Endpoint | μ„¤λ… |
|--------|----------|------|
| POST | `/api/payment/webhook` | λ λ¬μ¤ν€΄μ§€ μ›Ήν›… μμ‹  |

## π”’ λ³΄μ• κ³ λ ¤μ‚¬ν•­

1. **API ν‚¤ λ³΄νΈ**: ν™κ²½ λ³€μλ΅ κ΄€λ¦¬, μ λ€ ν΄λΌμ΄μ–ΈνΈμ— λ…Έμ¶ κΈμ§€
2. **μ›Ήν›… μ„λ… κ²€μ¦**: λ¨λ“  μ›Ήν›… μ”μ²­μ μ„λ… κ²€μ¦ ν•„μ
3. **μ¤‘λ³µ μ²λ¦¬ λ°©μ§€**: orderIdλ΅ μ΄λ―Έ μ²λ¦¬λ μ£Όλ¬Έ μ²΄ν¬
4. **νΈλμ­μ… μ‚¬μ©**: ν¬μΈνΈ λ³€κ²½ μ‹ DB νΈλμ­μ…μΌλ΅ μ›μμ„± λ³΄μ¥

## π§ ν…μ¤νΈ λ¨λ“

κ°λ° μ¤‘μ—λ” λ λ¬μ¤ν€΄μ§€ ν…μ¤νΈ λ¨λ“λ¥Ό μ‚¬μ©ν•μ„Έμ”:

1. λ€μ‹λ³΄λ“μ—μ„ Test Mode ν™μ„±ν™”
2. ν…μ¤νΈ API ν‚¤ μ‚¬μ©
3. ν…μ¤νΈ μΉ΄λ“λ΅ κ²°μ  ν…μ¤νΈ

### ν…μ¤νΈ μΉ΄λ“ μ •λ³΄
- μΉ΄λ“ λ²νΈ: `4242 4242 4242 4242`
- λ§λ£μΌ: λ―Έλ λ‚ μ§
- CVC: μ•„λ¬΄ μ«μ 3μλ¦¬

## π€ ν”„λ΅λ•μ… λ°°ν¬

1. λ λ¬μ¤ν€΄μ§€ Live Modeλ΅ μ „ν™
2. ν”„λ΅λ•μ… API ν‚¤λ΅ ν™κ²½ λ³€μ μ—…λ°μ΄νΈ
3. μ›Ήν›… URLμ„ ν”„λ΅λ•μ… λ„λ©”μΈμΌλ΅ λ³€κ²½
4. CLIENT_URLμ„ ν”„λ΅λ•μ… URLλ΅ λ³€κ²½

## π“ λ¨λ‹ν„°λ§

- λ λ¬μ¤ν€΄μ§€ λ€μ‹λ³΄λ“μ—μ„ μ£Όλ¬Έ/κ²°μ  ν„ν™© ν™•μΈ
- μ„λ²„ λ΅κ·Έμ—μ„ μ›Ήν›… μ²λ¦¬ μƒνƒ ν™•μΈ
- DBμ—μ„ PointTransaction ν…μ΄λΈ”λ΅ κ±°λ λ‚΄μ—­ μ¶”μ 

## β“ λ¬Έμ  ν•΄κ²°

### μ›Ήν›…μ΄ μμ‹ λμ§€ μ•λ” κ²½μ°
1. μ›Ήν›… URLμ΄ κ³µκ°μ μΌλ΅ μ ‘κ·Ό κ°€λ¥ν•μ§€ ν™•μΈ
2. μ„λ²„ λ΅κ·Έμ—μ„ μ—λ¬ ν™•μΈ
3. λ λ¬μ¤ν€΄μ§€ λ€μ‹λ³΄λ“μ—μ„ μ›Ήν›… μ „μ†΅ λ΅κ·Έ ν™•μΈ

### ν¬μΈνΈκ°€ μ¶©μ „λμ§€ μ•λ” κ²½μ°
1. μ›Ήν›… μ„λ… κ²€μ¦ ν™•μΈ
2. custom_dataμ— user_id, pointsκ°€ ν¬ν•¨λμ–΄ μλ”μ§€ ν™•μΈ
3. DB μ—°κ²° μƒνƒ ν™•μΈ

### κ²°μ  νμ΄μ§€λ΅ μ΄λ™ν•μ§€ μ•λ” κ²½μ°
1. Variant IDκ°€ μ¬λ°”λ¥Έμ§€ ν™•μΈ
2. API ν‚¤κ°€ μ ν¨ν•μ§€ ν™•μΈ
3. λΈλΌμ°μ € μ½μ†”μ—μ„ μ—λ¬ ν™•μΈ
